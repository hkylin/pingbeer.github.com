
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Title - My life Blog</title>
  <meta name="author" content="logep">

  
  <meta name="description" content="web.xml 详细介绍 1、启动一个WEB项目的时候，WEB容器会去读取它的配置文件web.xml，读取和&lt;context-param>两个结点。 2、紧急着，容创建一个ServletContext（servlet上下文），这个web项目的所有部分都将共享这个上下文。 3、容器将&lt; &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://pingbeer.github.io/blog/2014/01/12/title">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="My life Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">My life Blog</a></h1>
  
    <h2>一个人单着走了二十五个年头,何时是个头.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:pingbeer.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Title</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-01-12T20:46:14+08:00" pubdate data-updated="true">Jan 12<span>th</span>, 2014</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>web.xml 详细介绍</p>

<p>1、启动一个WEB项目的时候，WEB容器会去读取它的配置文件web.xml，读取<listener>和&lt;context-param>两个结点。</p>

<p>2、紧急着，容创建一个ServletContext（servlet上下文），这个web项目的所有部分都将共享这个上下文。</p>

<p>3、容器将&lt;context-param>转换为键值对，并交给servletContext。</p>

<p>4、容器创建<listener>中的类实例，创建监听器。</p>

<p>二  Load-on-startup</p>

<p>Load-on-startup 元素在web应用启动的时候指定了servlet被加载的顺序，它的值必须是一个整数。如果它的值是一个负整数或是这个元素不存在，那么容器会在该servlet被调用的时候，加载这个servlet 。如果值是正整数或零，容器在配置的时候就加载并初始化这个servlet，容器必须保证值小的先被加载。如果值相等，容器可以自动选择先加载谁。</p>

<p>在servlet的配置当中，&lt;load-on-startup>5&lt;/load-on-startup>的含义是：</p>

<p>标记容器是否在启动的时候就加载这个servlet。</p>

<p>当值为0或者大于0时，表示容器在应用启动时就加载这个servlet；</p>

<p>当是一个负数时或者没有指定时，则指示容器在该servlet被选择时才加载。</p>

<p>正数的值越小，启动该servlet的优先级越高。</p>

<p>三  加载顺序</p>

<p>首先可以肯定的是，加载顺序与它们在 web.xml 文件中的先后顺序无关。即不会因为 filter 写在 listener 的前面而会先加载 filter。最终得出的结论是：ServletContext &ndash;> listener &ndash;> filter &ndash;> servlet</p>

<pre><code>    同时还存在着这样一种配置节：context-param，它用于向 ServletContext 提供键值对，即应用程序上下文信息。我们的 listener, filter 等在初始化时会用到这些上下文中的信息，那么 context-param 配置节是不是应该写在 listener 配置节前呢？实际上 context-param 配置节可写在任意位置，因此真正的加载顺序为：context-param -&gt; listener -&gt; filter -&gt; servlet

    对于某类配置节而言，与它们出现的顺序是有关的。以 filter 为例，web.xml 中当然可以定义多个 filter，与 filter 相关的一个配置节是 filter-mapping，这里一定要注意，对于拥有相同 filter-name 的 filter 和 filter-mapping 配置节而言，filter-mapping 必须出现在 filter 之后，否则当解析到 filter-mapping 时，它所对应的 filter-name 还未定义。web 容器启动时初始化每个 filter 时，是按照 filter 配置节出现的顺序来初始化的，当请求资源匹配多个 filter-mapping 时，filter 拦截资源是按照 filter-mapping 配置节出现的顺序来依次调用 doFilter() 方法的。

    servlet 同 filter 类似，此处不再赘述。

   由此，可以看出，web.xml 的加载顺序是：ServletContext -&gt; context-param -&gt; listener -&gt; filter -&gt; servlet ，而同个类型之间的实际程序调用的时候的顺序是根据对应的 mapping 的顺序进行调用的。
</code></pre>

<p>四  web.xml文件详解</p>

<p>我将自己知道的web.xml的元素整理了一下：</p>

<p>web.xml首先是肯定要包含它的schema.</p>

<p>&lt;web-app xmlns=&ldquo;<a href="http://java.sun.com/xml/ns/j2ee">http://java.sun.com/xml/ns/j2ee</a>&rdquo;</p>

<pre><code>xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
version="2.4"&gt;
</code></pre>

<p>&lt;/web-app></p>

<p>其它的元素都放在&lt;web-app>&lt;/web-app>之中。</p>

<p><discription></discription> 是对站台的描述
&lt;display-name>&lt;/display-name> 定义站台的名称
<distributable/> 是指定该站台是否可分布式处理</p>

<p>&lt;context-param>&lt;/context-param> 用来设定web站台的环境参数，它包含两个子元素：</p>

<pre><code>&lt;param-name&gt;&lt;/param-name&gt; 用来指定参数的名称
&lt;param-value&gt;&lt;/param-value&gt; 用来设定参数值
</code></pre>

<p>比如：
&lt;context-param></p>

<pre><code>&lt;param-name&gt;my_param&lt;/param-name&gt;
&lt;param-value&gt;hello&lt;/param-value&gt;
</code></pre>

<p>&lt;/context-param></p>

<p>在此设定的参数，可以在servlet中用 getServletContext().getInitParameter(&ldquo;my_param&rdquo;) 来取得</p>

<p><filter></filter> 是用来声明filter的相关设定，它包含以下子元素：</p>

<pre><code>&lt;filter-name&gt;&lt;/filter-name&gt; 这当然就是指定filter的名字
&lt;filter-class&gt;&lt;/filter-class&gt; 这是用来定义filter的类的名称
&lt;init-param&gt;&lt;/init-param&gt; 用来定义参数，它有两个子元素：
    &lt;param-name&gt;&lt;/param-name&gt; 用来指定参数的名称
    &lt;param-value&gt;&lt;/param-value&gt; 用来设定参数值
</code></pre>

<p>比如：
<filter></p>

<pre><code>    &lt;filter-name&gt;setCharacterEncoding&lt;/filter-name&gt;
    &lt;filter-class&gt;com.myTest.setCharacterEncodingFilter&lt;/filter-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;encoding&lt;/param-name&gt;
        &lt;param-value&gt;GB2312&lt;/param-value&gt;
    &lt;/init-param&gt;
</code></pre>

<p></filter></p>

<p>与<filter></filter>同时使用的是&lt;filter-mapping>&lt;/filter-mapping> 用来定义filter所对应的URL，它有两个子元素：</p>

<pre><code>&lt;filter-name&gt;&lt;/filter-name&gt; 指定filter的名字
&lt;url-pattern&gt;&lt;/url-pattern&gt; 指定filter所对应的URL
</code></pre>

<p>比如：
&lt;filter-mapping></p>

<pre><code>    &lt;filter-name&gt;setCharacterEncoding&lt;/filter-name&gt;
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
</code></pre>

<p>&lt;/filter-mapping></p>

<p><listener></listener> 用来设定Listener接口，它的主要子元素为</p>

<pre><code>&lt;listener-class&gt;&lt;/listener-class&gt; 定义Listener的类名称
</code></pre>

<p>比如：
<listener></p>

<pre><code>&lt;listener-class&gt;com.myTest.ContextListener&lt;/listener-class&gt; 
</code></pre>

<p></listener></p>

<p><servlet></servlet> 用来声明一个servlet的数据，主要有以下子元素：</p>

<pre><code>&lt;servlet-name&gt;&lt;/servlet-name&gt; 指定servlet的名称
&lt;servlet-class&gt;&lt;/servlet-class&gt; 指定servlet的类名称
&lt;jsp-file&gt;&lt;/jsp-file&gt; 指定web站台中的某个JSP网页的完整路径
&lt;init-param&gt;&lt;/init-param&gt; 用来定义参数，和前面的&lt;init-param&gt;差不多
</code></pre>

<p>同样，与<servlet></servlet>一起使用的是&lt;servlet-mapping>&lt;/servlet-mapping> 用来定义servlet所对应的URL，包含两个子元素：</p>

<pre><code>&lt;servlet-name&gt;&lt;/servlet-name&gt; 指定servlet的名称
&lt;url-pattern&gt;&lt;/url-pattern&gt; 指定servlet所对应的URL
</code></pre>

<p>比如：
<servlet></p>

<pre><code>    &lt;servlet-name&gt;ShoppingServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;com.myTest.ShoppingServlet&lt;/servlet-class&gt;
</code></pre>

<p></servlet></p>

<p>&lt;servlet-mapping></p>

<pre><code>    &lt;servlet-name&gt;ShoppingServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/shop/ShoppingServlet&lt;/url-pattern&gt;
</code></pre>

<p>&lt;/servlet-mapping></p>

<p>&lt;session-config>&lt;/session-config> 用来定义web站台中的session参数，包含一个子元素：</p>

<pre><code>&lt;session-timeout&gt;&lt;/session-timeout&gt; 用来定义这个web站台所有session的有效期限，单位为                                                              分钟
</code></pre>

<p>&lt;mime-mapping>&lt;/mime-mapping> 定义某一个扩展名和某一个MIME Type做对映，包含两个                                                        子元素：</p>

<pre><code>&lt;extension&gt;&lt;/extension&gt; 扩展名的名称
&lt;mime-type&gt;&lt;/mime-type&gt; MIME格式
</code></pre>

<p>比如：
&lt;mime-mapping></p>

<pre><code>&lt;extension&gt;doc&lt;/extension&gt;
&lt;mime-type&gt;application/vnd.ms-word&lt;/mime-type&gt;
</code></pre>

<p>&lt;/mime-mapping>
&lt;mime-mapping></p>

<pre><code>&lt;extension&gt;xls&lt;/extension&gt;
&lt;mime-type&gt;application/vnd.ms-excel&lt;/mime-type&gt;
</code></pre>

<p>&lt;/mime-mapping></p>

<p>&lt;welcome-file-list>&lt;/welcom-file-list> 用来定义首页的列单，包含一个子元素：</p>

<pre><code>&lt;welcome-file&gt;&lt;/welcome-file&gt; 指定首页的文件名称
</code></pre>

<p>比如：
&lt;welcome-file-list></p>

<pre><code>&lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;
&lt;welcome-file&gt;index.html&lt;/welcome-file&gt;
</code></pre>

<p>&lt;/welcom-file-list></p>

<p>&lt;error-page>&lt;/error-page> 用来处理错误代码或异常的页面，有三个子元素：</p>

<pre><code>&lt;error-code&gt;&lt;/error-code&gt; 指定错误代码
&lt;exception-type&gt;&lt;/exception-type&gt; 指定一个JAVA异常类型
&lt;location&gt;&lt;/location&gt; 指定在web站台内的相关资源路径
</code></pre>

<p>比如：
&lt;error-page></p>

<pre><code>&lt;error-code&gt;404&lt;/error-code&gt;
&lt;location&gt;/error404.jsp&lt;/location&gt;
</code></pre>

<p>&lt;/error-page>
&lt;error-page></p>

<pre><code>&lt;exception-type&gt;java.lang.Exception&lt;/exception-type&gt;
&lt;location&gt;/exception.jsp&lt;/location&gt;
</code></pre>

<p>&lt;/error-page></p>

<p><taglib></taglib> 用来设定JSP网页所用到的Tag Library路径，有两个子元素：</p>

<pre><code>&lt;taglib-uri&gt;&lt;/taglib-uri&gt; 定义TLD文件的URI，在JSP网页中用taglib指令便可取得该URI的                                              TLD文件
&lt;taglib-location&gt;&lt;/taglib-location&gt; 指定TLD文件相对于web站台的存放位置
</code></pre>

<p>比如：
<taglib></p>

<pre><code>  &lt;taglib-uri&gt;myTaglib&lt;/taglib-uri&gt;
  &lt;taglib-location&gt;/WEB-INF/tlds/MyTaglib.tld&lt;/taglib-location&gt;
</code></pre>

<p></taglib></p>

<p>&lt;resource-ref>&lt;/resource-ref> 定义利用JNDI取得站台可利用的资源，有五个子元素：</p>

<pre><code>&lt;description&gt;&lt;/description&gt; 资源说明
&lt;rec-ref-name&gt;&lt;/rec-ref-name&gt; 资源名称
&lt;res-type&gt;&lt;/res-type&gt; 资源种类
&lt;res-auth&gt;&lt;/res-auth&gt; 资源经由Application或Container来许可
&lt;res-sharing-scope&gt;&lt;/res-sharing-scope&gt; 资源是否可以共享，有Shareable和Unshareable两个                                                                     值，默认为Shareable
</code></pre>

<p>比如，配置数据库连接池就可在此配置：
&lt;resource-ref></p>

<pre><code>    &lt;description&gt;JNDI JDBC DataSource of shop&lt;/description&gt;
    &lt;res-ref-name&gt;jdbc/sample_db&lt;/res-ref-name&gt;
    &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
    &lt;res-auth&gt;Container&lt;/res-auth&gt;
</code></pre>

<p>&lt;/resource-ref></p>

<p>&lt;jsp-config> 包括<taglib> 和&lt;jsp-property-group> 两个子元素。</p>

<pre><code>其中&lt;taglib&gt;元素在JSP 1.2时就已经存在；而&lt;jsp-property-group&gt;是JSP 2.0 新增的元素。
&lt;jsp-property-group&gt;元素主要有八个子元素，它们分别为：

1.&lt;description&gt;：设定的说明；
2.&lt;display-name&gt;：设定名称；
3.&lt;url-pattern&gt;：设定值所影响的范围，如：/CH2 或 /*.jsp；
4.&lt;el-ignored&gt;：若为true，表示不支持EL 语法；
5.&lt;scripting-invalid&gt;：若为true，表示不支持&lt;% scripting %&gt;语法；
6.&lt;page-encoding&gt;：设定JSP 网页的编码；
7.&lt;include-prelude&gt;：设置JSP 网页的抬头，扩展名为.jspf；
8.&lt;include-coda&gt;：设置JSP 网页的结尾，扩展名为.jspf。
</code></pre>

<p>一个简单的&lt;jsp-config>元素完整配置：</p>

<p>&lt;jsp-config></p>

<pre><code>&lt;taglib&gt;
    &lt;taglib-uri&gt;Taglib&lt;/taglib-uri&gt;
    &lt;taglib-location&gt;/WEB-INF/tlds/MyTaglib.tld&lt;/taglib-location&gt;
&lt;/taglib&gt;
&lt;jsp-property-group&gt;
    &lt;description&gt;Special property group for JSP Configuration JSP example.&lt;/description&gt;
    &lt;display-name&gt;JSPConfiguration&lt;/display-name&gt;
    &lt;url-pattern&gt;/jsp/* &lt;/url-pattern&gt;
    &lt;el-ignored&gt;true&lt;/el-ignored&gt;
    &lt;page-encoding&gt;GB2312&lt;/page-encoding&gt;
    &lt;scripting-invalid&gt;true&lt;/scripting-invalid&gt;
    &lt;include-prelude&gt;/include/prelude.jspf&lt;/include-prelude&gt;
    &lt;include-coda&gt;/include/coda.jspf&lt;/include-coda&gt;
&lt;/jsp-property-group&gt;
</code></pre>

<p>&lt;/jsp-config></p>

<p>配置web.xml来限制对某些servlet的请求</p>

<p>有时我们只希望通过认证的用户才能请求某些servlet的话，就可以在web.xml中来进行相应的配置，来达到此目的。</p>

<p>这就要用到&lt;security-constraint>&lt;/security-constraint>元素。
对于tomcat，中web.xml使用security-constraint元素需要在位于&lt;Tomcat-installation-directory>/conf/tomcat-users.xml的XML文件中创建用户名和密码。比如下面的这个tomcat-users.xml文件：</p>

<p>&lt;?xml version=&lsquo;1.0&rsquo; encoding=&lsquo;utf-8&rsquo;?>
&lt;tomcat-users>
  <role rolename="tomcat"/>
  <role rolename="manager"/>
  <role rolename="admin"/>
  <user username="tomcat" password="tomcat" roles="tomcat"/>
  <user username="both" password="tomcat" roles="tomcat,manager"/>
  <user username="admin" password="admin" roles="admin"/>
&lt;/tomcat-users></p>

<p>此XML片段包括一个tomcat-users根元素，它包含一个或多个role和user元素。</p>

<p>然后在Web应用程序的web.xml中创建security-constraint、login-config和security-role元素。</p>

<p>&lt;security-constraint></p>

<pre><code>  &lt;web-resource-collection&gt;
      &lt;web-resource-name&gt;HelloServlet&lt;/web-resource-name&gt;
      &lt;url-pattern&gt;/HelloServlet&lt;/url-pattern&gt;
      &lt;http-method&gt;GET&lt;/http-method&gt;
      &lt;http-method&gt;POST&lt;/http-method&gt;
  &lt;/web-resource-collection&gt;
  &lt;auth-constraint&gt;
      &lt;description&gt;This applies only to the "tomcat" security role&lt;/description&gt;
      &lt;role-name&gt;admin&lt;/role-name&gt;
  &lt;/auth-constraint&gt;
  &lt;user-data-constraint&gt;
      &lt;transport-guarantee&gt;NONE&lt;/transport-guarantee&gt;
  &lt;/user-data-constraint&gt;
</code></pre>

<p>  &lt;/security-constraint></p>

<p>  &lt;login-config></p>

<pre><code>  &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
</code></pre>

<p>  &lt;/login-config>
  &lt;security-role></p>

<pre><code>  &lt;role-name&gt;admin&lt;/role-name&gt;
</code></pre>

<p>  &lt;/security-role></p>

<p>其中security-constraint元素包含一个或多个web-resource-collection元素，它是描述Web应用程序中的哪些web资源受到指定安全限制的保护。http-method元素指定安全限制覆盖的HTTP方法。上面的例子中，当我们对/HelloServlet的GET或POST请求时将触发配置的安全机制。
auth-constraint元素用于描述允许访问Web组件的安全角色。此例中安全角色的例子有tomcat、manager、admin。而只有当作为admin角色的用户才可以访问HelloServlet。</p>

<p>Web应用程序通过login-config元素来认证用户，并确认该用户是否为正确的角色。
longin-config包含的transport-guarantee子元素用来指定认证方法，BASIC是一种常见的Web认证方式，浏览器给用户提示一个对话框，要求输入用户名和密码，随后Tomcat将给出的用户名和密码与tomcat-users.xml中的用户名和密码进行比较，然后使用前面的security-constraint配置来确定用户是否可访问受保护的servlet。</p>

<p>（除BASIC外，还可以是FORM、CLIENT-CERT、DIGEST等）</p>

<p>其实这种认证方法实际上有两个步骤：
1、检查提供的用户名和密码是否正确。
2、判断用户是否映射到特定的安全角色。例如，用户可能提供了正确的用户名和密码，但没有映射到特定的安全角色，也将被禁止访问特定的Web资源。</p>

<p>五 相应元素配置</p>

<p>1、Web应用图标：指出IDE和GUI工具用来表示Web应用的大图标和小图标  <br/>
<icon>  <br/>
&lt;small-icon>/images/app_small.gif&lt;/small-icon>  <br/>
&lt;large-icon>/images/app_large.gif&lt;/large-icon>  <br/>
</icon>  <br/>
2、Web 应用名称：提供GUI工具可能会用来标记这个特定的Web应用的一个名称  <br/>
&lt;display-name>Tomcat Example&lt;/display-name>  <br/>
3、Web 应用描述： 给出于此相关的说明性文本  <br/>
<disciption>Tomcat Example servlets and JSP pages.</disciption>  <br/>
4、上下文参数：声明应用范围内的初始化参数。  <br/>
&lt;context-param></p>

<pre><code>&lt;param-name&gt;ContextParameter&lt;/para-name&gt;    
&lt;param-value&gt;test&lt;/param-value&gt;    
&lt;description&gt;It is a test parameter.&lt;/description&gt;    
</code></pre>

<p>&lt;/context-param>  <br/>
在servlet里面可以通过getServletContext().getInitParameter(&ldquo;context/param&rdquo;)得到</p>

<p>5、过滤器配置：将一个名字与一个实现javaxs.servlet.Filter接口的类相关联。  <br/>
<filter></p>

<pre><code>    &lt;filter-name&gt;setCharacterEncoding&lt;/filter-name&gt;    
    &lt;filter-class&gt;com.myTest.setCharacterEncodingFilter&lt;/filter-class&gt;    
    &lt;init-param&gt;    
        &lt;param-name&gt;encoding&lt;/param-name&gt;    
        &lt;param-value&gt;GB2312&lt;/param-value&gt;    
    &lt;/init-param&gt;    
</code></pre>

<p></filter>  <br/>
&lt;filter-mapping></p>

<pre><code>    &lt;filter-name&gt;setCharacterEncoding&lt;/filter-name&gt;    
    &lt;url-pattern&gt;/*&lt;/url-pattern&gt;    
</code></pre>

<p>&lt;/filter-mapping>  <br/>
6、监听器配置  <br/>
<listener></p>

<pre><code>  &lt;listerner-class&gt;listener.SessionListener&lt;/listener-class&gt;    
</code></pre>

<p></listener>  <br/>
7、Servlet配置  <br/>
   基本配置  <br/>
   <servlet></p>

<pre><code>  &lt;servlet-name&gt;snoop&lt;/servlet-name&gt;    
  &lt;servlet-class&gt;SnoopServlet&lt;/servlet-class&gt;    
</code></pre>

<p>   </servlet>  <br/>
   &lt;servlet-mapping></p>

<pre><code>  &lt;servlet-name&gt;snoop&lt;/servlet-name&gt;    
  &lt;url-pattern&gt;/snoop&lt;/url-pattern&gt;    
</code></pre>

<p>   &lt;/servlet-mapping>  <br/>
   高级配置  <br/>
   <servlet></p>

<pre><code>  &lt;servlet-name&gt;snoop&lt;/servlet-name&gt;    
  &lt;servlet-class&gt;SnoopServlet&lt;/servlet-class&gt;    
  &lt;init-param&gt;    
     &lt;param-name&gt;foo&lt;/param-name&gt;    
     &lt;param-value&gt;bar&lt;/param-value&gt;    
  &lt;/init-param&gt;    
  &lt;run-as&gt;    
     &lt;description&gt;Security role for anonymous access&lt;/description&gt;    
     &lt;role-name&gt;tomcat&lt;/role-name&gt;    
  &lt;/run-as&gt;    
</code></pre>

<p>   </servlet>  <br/>
   &lt;servlet-mapping></p>

<pre><code>  &lt;servlet-name&gt;snoop&lt;/servlet-name&gt;    
  &lt;url-pattern&gt;/snoop&lt;/url-pattern&gt;    
</code></pre>

<p>   &lt;/servlet-mapping>  <br/>
   元素说明</p>

<pre><code> &lt;servlet&gt;&lt;/servlet&gt; 用来声明一个servlet的数据，主要有以下子元素：    
 &lt;servlet-name&gt;&lt;/servlet-name&gt; 指定servlet的名称    
 &lt;servlet-class&gt;&lt;/servlet-class&gt; 指定servlet的类名称    
 &lt;jsp-file&gt;&lt;/jsp-file&gt; 指定web站台中的某个JSP网页的完整路径    
 &lt;init-param&gt;&lt;/init-param&gt; 用来定义参数，可有多个init-param。在servlet类中通过getInitParamenter(String name)方法访问初始化参数    
 &lt;load-on-startup&gt;&lt;/load-on-startup&gt;指定当Web应用启动时，装载Servlet的次序。    
                             当值为正数或零时：Servlet容器先加载数值小的servlet，再依次加载其他数值大的servlet.    
                             当值为负或未定义：Servlet容器将在Web客户首次访问这个servlet时加载它    
 &lt;servlet-mapping&gt;&lt;/servlet-mapping&gt; 用来定义servlet所对应的URL，包含两个子元素    
   &lt;servlet-name&gt;&lt;/servlet-name&gt; 指定servlet的名称    
   &lt;url-pattern&gt;&lt;/url-pattern&gt; 指定servlet所对应的URL    
</code></pre>

<p>8、会话超时配置（单位为分钟）  <br/>
   &lt;session-config></p>

<pre><code>  &lt;session-timeout&gt;120&lt;/session-timeout&gt;    
</code></pre>

<p>   &lt;/session-config>  <br/>
9、MIME类型配置  <br/>
   &lt;mime-mapping></p>

<pre><code>  &lt;extension&gt;htm&lt;/extension&gt;    
  &lt;mime-type&gt;text/html&lt;/mime-type&gt;    
</code></pre>

<p>   &lt;/mime-mapping>  <br/>
10、指定欢迎文件页配置  <br/>
   &lt;welcome-file-list></p>

<pre><code>  &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;    
  &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;    
  &lt;welcome-file&gt;index.htm&lt;/welcome-file&gt;    
</code></pre>

<p>   &lt;/welcome-file-list>  <br/>
11、配置错误页面  <br/>
一、 通过错误码来配置error-page  <br/>
   &lt;error-page></p>

<pre><code>  &lt;error-code&gt;404&lt;/error-code&gt;    
  &lt;location&gt;/NotFound.jsp&lt;/location&gt;    
</code></pre>

<p>   &lt;/error-page>  <br/>
上面配置了当系统发生404错误时，跳转到错误处理页面NotFound.jsp。  <br/>
二、通过异常的类型配置error-page  <br/>
   &lt;error-page></p>

<pre><code>   &lt;exception-type&gt;java.lang.NullException&lt;/exception-type&gt;    
   &lt;location&gt;/error.jsp&lt;/location&gt;    
</code></pre>

<p>   &lt;/error-page>  <br/>
上面配置了当系统发生java.lang.NullException（即空指针异常）时，跳转到错误处理页面error.jsp  <br/>
12、TLD配置  <br/>
   <taglib></p>

<pre><code>   &lt;taglib-uri&gt;http://jakarta.apache.org/tomcat/debug-taglib&lt;/taglib-uri&gt;    
   &lt;taglib-location&gt;/WEB-INF/jsp/debug-taglib.tld&lt;/taglib-location&gt;    
</code></pre>

<p>   </taglib>  <br/>
   如果MyEclipse一直在报错,应该把<taglib> 放到 &lt;jsp-config>中  <br/>
   &lt;jsp-config></p>

<pre><code>  &lt;taglib&gt;    
      &lt;taglib-uri&gt;http://jakarta.apache.org/tomcat/debug-taglib&lt;/taglib-uri&gt;    
      &lt;taglib-location&gt;/WEB-INF/pager-taglib.tld&lt;/taglib-location&gt;    
  &lt;/taglib&gt;    
</code></pre>

<p>   &lt;/jsp-config>  <br/>
13、资源管理对象配置  <br/>
   &lt;resource-env-ref></p>

<pre><code>   &lt;resource-env-ref-name&gt;jms/StockQueue&lt;/resource-env-ref-name&gt;    
</code></pre>

<p>   &lt;/resource-env-ref>  <br/>
14、资源工厂配置  <br/>
   &lt;resource-ref></p>

<pre><code>   &lt;res-ref-name&gt;mail/Session&lt;/res-ref-name&gt;    
   &lt;res-type&gt;javax.mail.Session&lt;/res-type&gt;    
   &lt;res-auth&gt;Container&lt;/res-auth&gt;    
</code></pre>

<p>   &lt;/resource-ref>  <br/>
   配置数据库连接池就可在此配置：  <br/>
   &lt;resource-ref></p>

<pre><code>   &lt;description&gt;JNDI JDBC DataSource of shop&lt;/description&gt;    
   &lt;res-ref-name&gt;jdbc/sample_db&lt;/res-ref-name&gt;    
   &lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;    
   &lt;res-auth&gt;Container&lt;/res-auth&gt;    
</code></pre>

<p>   &lt;/resource-ref>  <br/>
15、安全限制配置  <br/>
   &lt;security-constraint></p>

<pre><code>  &lt;display-name&gt;Example Security Constraint&lt;/display-name&gt;    
  &lt;web-resource-collection&gt;    
     &lt;web-resource-name&gt;Protected Area&lt;/web-resource-name&gt;    
     &lt;url-pattern&gt;/jsp/security/protected/*&lt;/url-pattern&gt;    
     &lt;http-method&gt;DELETE&lt;/http-method&gt;    
     &lt;http-method&gt;GET&lt;/http-method&gt;    
     &lt;http-method&gt;POST&lt;/http-method&gt;    
     &lt;http-method&gt;PUT&lt;/http-method&gt;    
  &lt;/web-resource-collection&gt;    
  &lt;auth-constraint&gt;    
    &lt;role-name&gt;tomcat&lt;/role-name&gt;    
    &lt;role-name&gt;role1&lt;/role-name&gt;    
  &lt;/auth-constraint&gt;    
</code></pre>

<p>   &lt;/security-constraint>  <br/>
16、登陆验证配置  <br/>
   &lt;login-config></p>

<pre><code> &lt;auth-method&gt;FORM&lt;/auth-method&gt;    
 &lt;realm-name&gt;Example-Based Authentiation Area&lt;/realm-name&gt;    
 &lt;form-login-config&gt;    
    &lt;form-login-page&gt;/jsp/security/protected/login.jsp&lt;/form-login-page&gt;    
    &lt;form-error-page&gt;/jsp/security/protected/error.jsp&lt;/form-error-page&gt;    
 &lt;/form-login-config&gt;    
</code></pre>

<p>   &lt;/login-config>  <br/>
17、安全角色：security-role元素给出安全角色的一个列表，这些角色将出现在servlet元素内的security-role-ref元素的role-name子元素中。</p>

<pre><code>分别地声明角色可使高级IDE处理安全信息更为容易。    
</code></pre>

<p>&lt;security-role></p>

<pre><code> &lt;role-name&gt;tomcat&lt;/role-name&gt;    
</code></pre>

<p>&lt;/security-role>  <br/>
18、Web环境参数：env-entry元素声明Web应用的环境项  <br/>
&lt;env-entry></p>

<pre><code> &lt;env-entry-name&gt;minExemptions&lt;/env-entry-name&gt;    
 &lt;env-entry-value&gt;1&lt;/env-entry-value&gt;    
 &lt;env-entry-type&gt;java.lang.Integer&lt;/env-entry-type&gt;    
</code></pre>

<p>&lt;/env-entry>  <br/>
19、EJB 声明  <br/>
&lt;ejb-ref></p>

<pre><code> &lt;description&gt;Example EJB reference&lt;/decription&gt;    
 &lt;ejb-ref-name&gt;ejb/Account&lt;/ejb-ref-name&gt;    
 &lt;ejb-ref-type&gt;Entity&lt;/ejb-ref-type&gt;    
 &lt;home&gt;com.mycompany.mypackage.AccountHome&lt;/home&gt;    
 &lt;remote&gt;com.mycompany.mypackage.Account&lt;/remote&gt;    
</code></pre>

<p>&lt;/ejb-ref>  <br/>
20、本地EJB声明  <br/>
&lt;ejb-local-ref></p>

<pre><code> &lt;description&gt;Example Loacal EJB reference&lt;/decription&gt;    
 &lt;ejb-ref-name&gt;ejb/ProcessOrder&lt;/ejb-ref-name&gt;    
 &lt;ejb-ref-type&gt;Session&lt;/ejb-ref-type&gt;    
 &lt;local-home&gt;com.mycompany.mypackage.ProcessOrderHome&lt;/local-home&gt;    
 &lt;local&gt;com.mycompany.mypackage.ProcessOrder&lt;/local&gt;    
</code></pre>

<p>&lt;/ejb-local-ref>  <br/>
21、配置DWR  <br/>
<servlet></p>

<pre><code>  &lt;servlet-name&gt;dwr-invoker&lt;/servlet-name&gt;    
  &lt;servlet-class&gt;uk.ltd.getahead.dwr.DWRServlet&lt;/servlet-class&gt;    
</code></pre>

<p></servlet>  <br/>
&lt;servlet-mapping></p>

<pre><code>  &lt;servlet-name&gt;dwr-invoker&lt;/servlet-name&gt;    
  &lt;url-pattern&gt;/dwr/*&lt;/url-pattern&gt;    
</code></pre>

<p>&lt;/servlet-mapping>  <br/>
22、配置Struts</p>

<pre><code>&lt;display-name&gt;Struts Blank Application&lt;/display-name&gt;    
&lt;servlet&gt;    
    &lt;servlet-name&gt;action&lt;/servlet-name&gt;    
    &lt;servlet-class&gt;    
        org.apache.struts.action.ActionServlet    
    &lt;/servlet-class&gt;    
    &lt;init-param&gt;    
        &lt;param-name&gt;detail&lt;/param-name&gt;    
        &lt;param-value&gt;2&lt;/param-value&gt;    
    &lt;/init-param&gt;    
    &lt;init-param&gt;    
        &lt;param-name&gt;debug&lt;/param-name&gt;    
        &lt;param-value&gt;2&lt;/param-value&gt;    
    &lt;/init-param&gt;    
    &lt;init-param&gt;    
        &lt;param-name&gt;config&lt;/param-name&gt;    
        &lt;param-value&gt;/WEB-INF/struts-config.xml&lt;/param-value&gt;    
    &lt;/init-param&gt;    
    &lt;init-param&gt;    
        &lt;param-name&gt;application&lt;/param-name&gt;    
        &lt;param-value&gt;ApplicationResources&lt;/param-value&gt;    
    &lt;/init-param&gt;    
    &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;    
&lt;/servlet&gt;    
&lt;servlet-mapping&gt;    
    &lt;servlet-name&gt;action&lt;/servlet-name&gt;    
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;    
&lt;/servlet-mapping&gt;    
&lt;welcome-file-list&gt;    
    &lt;welcome-file&gt;index.jsp&lt;/welcome-file&gt;    
&lt;/welcome-file-list&gt;    

&lt;!-- Struts Tag Library Descriptors --&gt;    
&lt;taglib&gt;    
    &lt;taglib-uri&gt;struts-bean&lt;/taglib-uri&gt;    
    &lt;taglib-location&gt;/WEB-INF/tld/struts-bean.tld&lt;/taglib-location&gt;    
&lt;/taglib&gt;    
&lt;taglib&gt;    
    &lt;taglib-uri&gt;struts-html&lt;/taglib-uri&gt;    
    &lt;taglib-location&gt;/WEB-INF/tld/struts-html.tld&lt;/taglib-location&gt;    
&lt;/taglib&gt;    
&lt;taglib&gt;    
&lt;taglib-uri&gt;struts-nested&lt;/taglib-uri&gt;    
&lt;taglib-location&gt;/WEB-INF/tld/struts-nested.tld&lt;/taglib-location&gt;    
&lt;/taglib&gt;    
&lt;taglib&gt;    
    &lt;taglib-uri&gt;struts-logic&lt;/taglib-uri&gt;    
    &lt;taglib-location&gt;/WEB-INF/tld/struts-logic.tld&lt;/taglib-location&gt;    
&lt;/taglib&gt;    
&lt;taglib&gt;    
    &lt;taglib-uri&gt;struts-tiles&lt;/taglib-uri&gt;    
    &lt;taglib-location&gt;/WEB-INF/tld/struts-tiles.tld&lt;/taglib-location&gt;    
&lt;/taglib&gt;    
</code></pre>

<p>23、配置Spring（基本上都是在Struts中配置的）</p>

<p>   <!-- 指定spring配置文件位置 -->  <br/>
   &lt;context-param></p>

<pre><code>  &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;    
  &lt;param-value&gt;    
   &lt;!--加载多个spring配置文件 --&gt;    
    /WEB-INF/applicationContext.xml, /WEB-INF/action-servlet.xml    
  &lt;/param-value&gt;    
</code></pre>

<p>   &lt;/context-param></p>

<p>   <!-- 定义SPRING监听器，加载spring --></p>

<p><listener></p>

<pre><code> &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;    
</code></pre>

<p></listener></p>

<p><listener></p>

<pre><code> &lt;listener-class&gt;    
   org.springframework.web.context.request.RequestContextListener    
 &lt;/listener-class&gt;    
</code></pre>

<p></listener></p>

<p>其他说明：</p>

<p>web.xml 文件中一般包括 servlet, spring, filter, listenr的配置。那么他们是按照一个什么顺序加载呢？</p>

<p>加载顺序会影响对spring bean 的调用。</p>

<pre><code>比如filter 需要用到 bean ，但是加载顺序是 先加载filter 后加载spring，则filter中初始化操作中的bean为null；
</code></pre>

<p>首先可以肯定 加载顺序与他们在web.xml 文件中的先后顺序无关。</p>

<p>web.xml 中 listener 和 serverlet 的加载顺序为 先 listener 后serverlet</p>

<p>最终得出结果：先 listener >> filter >> servlet >>  spring</p>

<p> 所以，如果过滤器中要使用到 bean，可以将spring 的加载 改成 Listener的方式</p>

<p><listener></p>

<pre><code>    &lt;listener-class&gt;
        org.springframework.web.context.ContextLoaderListener
    &lt;/listener-class&gt;
&lt;/listener&gt;
</code></pre>

<p> 搞定！</p>

<p> 关于他们的内部执行顺序，也需要注意，如下面文章中遇到的问题</p>

<p>web.xml的filter执行顺序导致的乱码，切记！
2008-05-02 01:38</p>

<p>发现引起bug的原因是web.xml的下面几行：</p>

<pre><code>&lt;filter-mapping&gt;
    &lt;filter-name&gt;SecurityFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;CharacterEncoding&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;CharacterEncoding&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre>

<p>根据servlet2.3规范filter执行是按照web.xml配置的filter-mapping先后顺序进行执行，所以上面的配置会导致遇见*.do的url请求，先进行SecurityFilter的过滤器处理，这时候没有做编码处理，已经是乱码，到下面的filter处理时已经时乱码，再做编码处理已经没有用处。</p>

<p>修正方式，调整filter-mapping顺序，如下：</p>

<pre><code>&lt;filter-mapping&gt;
    &lt;filter-name&gt;CharacterEncoding&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;CharacterEncoding&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;SecurityFilter&lt;/filter-name&gt;
    &lt;url-pattern&gt;*.do&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;
</code></pre>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">logep</span></span>

      








  


<time datetime="2014-01-12T20:46:14+08:00" pubdate data-updated="true">Jan 12<span>th</span>, 2014</time>
      


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://pingbeer.github.io/blog/2014/01/12/title/" data-via="" data-counturl="http://pingbeer.github.io/blog/2014/01/12/title/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/blog/2014/01/15/title2/" title="Next Post: title2">title2 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2014/01/21/blog/">Blog</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/21/web/">Web</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/17/css/">Css</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/15/title2/">Title2</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/12/title/">Title</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - logep -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'beerhn';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://pingbeer.github.io/blog/2014/01/12/title/';
        var disqus_url = 'http://pingbeer.github.io/blog/2014/01/12/title/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
