<form action="member-orderpay.html" method="post" autocomplete="off" id="form" class="n-validator n-default" novalidate="novalidate">
		<input id="pid" name="pid" value="" type="hidden">
			<input id="sum_id" name="sum_id" value="14660722" type="hidden">
			<input id="sum_allAmount" name="sum_allAmount" value="30.00" type="hidden">
			<input id="amount" name="amount" value="30.00" type="hidden">
			<input id="sum_paytype" name="sum_paytype" value="ccbline" type="hidden">
			<input id="mobile" name="sum_mobile" value="18260269335" type="hidden">
			<input id="cardcode" name="cardcode" value="6221682391850299" type="hidden">
			<input id="indentifycode" name="indentifycode" value="430524198806148675" type="hidden">
			<input id="source" name="source" value="film" type="hidden">
			<div class="htdd_right1">
				<div class="htdd_m1">
					<div class=" htdd_m1_left">
						付款方式：
					</div>
					<div class="htdd_m1_right">
						<div class="ypzf_m2_pic22">
							<img src="/film_v4/img/ccb/jh.png" width="188" height="45">
						</div>
					</div>
				</div>
				<div class="htdd_m1">
				 
				  <div class="xyk">
						您正在使用网信用卡服务，为了保障您的资金安全，请输入以下带“<span class="red">*</span>”的信息。我们将与银行核实 </div>
					
				</div>
				<div class="htdd_m1">
				  <div class=" htdd_m1_left">
						<span class="red">*</span> 信用卡卡号：
					</div>
					<div class="htdd_m1_right">
						<input type="text" id="cardNo" name="cardNo" value="" class="kh" size="16" maxlength="16" data-rule="" data-rule-cardno="" readonly="readonly">
					</div>
				</div>
				 <div class="htdd_m1">
				  <div class=" htdd_m1_left">
						<span class="red">*</span> 身份证号：
					</div>
					<div class="htdd_m1_right">
						<input type="text" id="identification" name="identification" value="" class="kh" size="18" maxlength="18" data-rule="" readonly="readonly" data-rule-cardno="">
					</div>
				</div> 
				<div class="htdd_m1">
					<div class=" htdd_m1_left">
						<span class="red">*</span> 有效期(月年)：
					</div>
					<div class="htdd_m1_right">
						<input type="text" name="cardEndDate" id="cardEndDate" value="" class="htdd_se n-valid" size="4" maxlength="4" onblur="if(this.value=='')this.value='MMyy(月月年年)'" onfocus="if(this.value=='MMyy(月月年年)')this.value=''" data-rule-cardenddate="[/^\d{4}$/, '请输入4位数字']" aria-required="true" aria-invalid="false" data-inputstatus="ok"><span class="msg-box n-right" style="" for="cardEndDate"><span class="msg-wrap n-ok" role="alert"><span class="n-icon"></span><span class="n-msg"></span></span></span> 
					&nbsp;	
					</div>
				</div>
				<div class="htdd_m1">
					<div class=" htdd_m1_left">
						<span class="red">*</span>请输入CVV2码：
			    </div>
					<div class="htdd_m1_right">
						<input type="text" name="cvv2" id="htdd" class="htdd_s2 n-valid" size="3" value="" maxlength="3" onblur="if(this.value=='')this.value='请输入信用卡背面三位CVV2码'" onfocus="if(this.value=='请输入信用卡背面三位CVV2码')this.value=''" data-rule-htdd="[/^\d{3}$/, '请输入3位数字']" aria-required="true" aria-invalid="false" data-inputstatus="ok"><span class="msg-box n-right" style="" for="htdd"><span class="msg-wrap n-ok" role="alert"><span class="n-icon"></span><span class="n-msg"></span></span></span> 
					&nbsp;	
					</div>
				</div>
				<div class="htdd_m1">
					<div class=" htdd_m1_left">
						<span class="red">*</span> 银行存留号码：
					</div>
					
					<div class="htdd_m1_right">
						<input type="text" name="phone" id="phone" value="" class="htdd_sl n-valid" size="11" maxlength="11" data-rule-phone="[/^\d{11}$/, '请输入11位数字']" aria-required="true" aria-invalid="false" data-inputstatus="ok"> 
						&nbsp; 
						<input type="button" id="sendSMS" value="发送手机验证码" class="fsdtm222">
						<span class="msg-box n-right" style="position:static;" for="phone"><span class="msg-wrap n-ok" role="alert"><span class="n-icon"></span><span class="n-msg"></span></span></span>
						
						&nbsp;
					</div>
				</div>
				<div class="htdd_m1">
					<div class=" htdd_m1_left">
						<span class="red">*</span> 手机验证码：
					</div>
					<div class="htdd_m1_right">
						<input type="text" name="vcode" id="vcode" class="htdd_sl n-valid" style="width: 60px;" size="6" maxlength="6" aria-required="true" aria-invalid="false" data-inputstatus="ok"><span class="msg-box n-right" style="" for="vcode"><span class="msg-wrap n-ok" role="alert"><span class="n-icon"></span><span class="n-msg"></span></span></span>
					</div>
				</div>
				<!-- 
				<div class="htdd_m1">
					<div class=" htdd_m1_left">
						<span class="red">*</span> 证件类型：
					</div>
					<div class="htdd_m1_right">
						<select name="identityType" onchange="showandhide(this.value)"
							class="htdd_sh2">
							<option value="0">身份证</option>
							<option value="1">护照</option>
							<option value="2">军官证</option>
						</select>
					</div>
				</div>
				 -->
				<!--<div class="htdd_m1">
					<div class=" htdd_m1_left">
						<span class="red">*</span> 身份证号：
					</div>
					<div class="htdd_m1_right">
						<input type="text" id="identityNo" name=identityNo class="kh" size="18" maxlength="18" />
					</div>
				</div>-->
				
				  <!-- <div class="htdd_m1_ty">
				  <input name="sure" id="sure" type="checkbox" checked="checked" data-rule="请勾选同意;checked;checkbox22"/>

						同意（重要提示：请仔细阅读快捷支付服务协议，同意并勾选后付款）
						<a href="http://www.spider.com.cn/help/tpfwgz.html" target="_blank" class=" bule_a">《蜘蛛网快捷支付服务协议》&nbsp;</a>
					</div> -->
				
				<div class="htdd_m1">
					<div class=" htdd_m1_left">
						&nbsp;
					</div>
					<div class="htdd_m1_right">
						<input type="button" name="button" id="submitBtn" value="正在提交...." class="htdd_an" disabled="disabled">
					</div>
				</div>
			</div>
		</form>
		<script type="text/javascript">
var interval;
var requestCount = 1;
        $(function(){
        	if(''!=$("#cardcode").val()){
        		$("#cardNo").val($("#cardcode").val());
        		$("#identification").val($("#indentifycode").val());
        		$("#cardNo").attr("readonly","readonly");
        		$("#cardNo").attr("data-rule","");
        		$("#cardNo").attr("data-rule-cardNo","");
        		$("#identification").attr("readonly","readonly");
        		$("#identification").attr("data-rule","");
        		$("#identification").attr("data-rule-cardNo","");
        	}
        	$("#sendSMS").click(function(){
	        	var _phone = $("#phone").val();
        		if(_phone=='' || _phone.length!=11){
        			tipsWindownNew( "请先输入手机号码，手机号码的长度必须为11位数！","520", "170","0");
        			return false;
        		}
        		$("#sendSMS").attr("disabled",false);
        		//time(100);
	        	//var _url = "http://192.168.1.127:8082/pay/common/sendccbmsg?callback=?";
	      var _url  = "http://pay.spider.com.cn/common/sendccbmsg?callback=?"
	        	var allAmount = "30.00";
				$.ajax({
					url:_url,
					type:"get",
					data:{phone:_phone,
						allAmount:allAmount,
						source:'film'},
					dataType:"json",
					success:function(r){
						if(r!="0"||r!=0){
							var t = 100-parseInt(r);
							time(t);
						}else{
							time(100);
						}
					},
					error:function(){
						tipsWindownNew( "验证码发送失败，请重试！！","520", "170","0");
					}
				});
	        });
        	$("#submitBtn").click(function(){
        		var reg = new RegExp("^[0-9]*$");
        		var card = $("#cardNo").val();
        		var enddate = $("#cardEndDate").val();
        		var cvv2 = $("#htdd").val();
        		var phone = $("#phone").val();
        		var code = $("#vcode").val();
        		var check =$("#checkbox22").attr("aria-invalid");
        	//	alert((!reg.test(card)||card.length!=16)+":"+(!reg.test(enddate)||enddate.length!=4)+":"+(!reg.test(cvv2)||cvv2.length!=3)+":"+(!reg.test(phone)||phone.length!=11)+":"+(!reg.test(code)||code.length!=6));
        		if(!reg.test(card)||card.length!=16)return;
        		if(!reg.test(enddate)||enddate.length!=4)return;
        		if(!reg.test(cvv2)||cvv2.length!=3)return;
//	       		if(identification.length<18)return;
        		if(!reg.test(phone)||phone.length!=11)return;
        		if(!reg.test(code)||code.length!=6)return;
        		$("#submitBtn").attr("disabled", true);
				$("#submitBtn").val("正在提交....");
        		var flag = false;
        		$.ajax({
					url:"member-orderpay.html",
					type:"post",
					scriptCharset: 'utf-8',
					data:{sum_id:$("#sum_id").val(),
						sum_allAmount:$("#sum_allAmount").val(),
						amount:$("#amount").val(),
						sum_paytype:$("#sum_paytype").val(),
						source:$("#source").val(),
						cardNo:$("#cardNo").val(),
						cardEndDate:$("#cardEndDate").val(),
						phone:$("#phone").val(),
						sum_mobile:$("#mobile").val(),
						identification:$("#identification").val(),
						cvv2:$("#htdd").val(),
						vcode:$("#vcode").val()},
						 dataType: 'html',
					success:function(r){
						if("0"==r){
							 getshowtip("show","");
								interval = window.setInterval("validatePaystatus()",2000);
						}else if(r=='A'){
							$("#successbtn").show();
							$(".btnGray2").hide();
							getshowtip("message","已支付,勿重复支付,请至\"我的订单\"查看取票码");
						}else{
							 getshowtip("message","订单正在处理中，请稍后返回到<a href='http://www.spider.com.cn/accountfilmorders.html' class=\"ml5 mr5 f18 blue1\" style=\"text-decoration:underline;\">我的订单</a>中查看订单处理情况");
						}
						/* var re = /^[0-9]+.?[0-9]*$/;         
					     if (!re.test(r)) {
					    	 if(""!=r||" "!=r||"null"!=r){
					    		 getshowtip("message",r);
					    	 }else{
					    		 getshowtip("message","订单正在处理中，请稍后返回到“我的订单”中查看订单处理情况");
					    	 }
					    	 
					     }else{
					    	 if(""!=r||" "!=r){
									$("#pid").val(r);
								}
					    	 getshowtip("show","");
								interval = window.setInterval("validatePaystatus()",2000);
					     }  */
					/* 	$("#submitBtn").attr("disabled", false);
						$("#submitBtn").val("提交");
						if(r=="-1"||r=="-2"||r=="-3"){
							tipsWindownNew( "交易失败，请核对输入信息！","520", "170","0");
						}else if(r.replace(/(^\s*)|(\s*$)/g, "")==''){
							tipsWindownNew( "支付异常，建议您重试。","520", "170","0");
						}else if(r=='3030'){
							window.location="/ticket-qryorder.html";
						}else if(r=='-5'){
							tipsWindownNew( "已有支"付记录，请勿重复提交！","520", "170","0");
							$("#submitBtn").attr("disabled", true);
							$("#submitBtn").val("提交");
						}else if(r=='-7'){
							tipsWindownNew( "订单正在处理中，请稍后返回到“我的订单”中查看订单处理情况","520", "170","0");
							$("#submitBtn").attr("disabled", true);
							$("#submitBtn").val("提交");
						}else if(r=='1010'){
							window.location="/error.jsp";
						//	alert("请票失败！");
						}else{
							tipsWindownNew( r.substr(0, 20),"520", "170","0");
						} */
					},
					error:function(){
						$("#submitBtn").attr("disabled", false);
						$("#submitBtn").val("提交");
						 getshowtip("message","订单正在处理中，请稍后返回到<a href='http://www.spider.com.cn/accountfilmorders.html' class=\"ml5 mr5 f18 blue1\" style=\"text-decoration:underline;\">我的订单</a>中查看订单处理情况");
					}
				});
				});
        	});
        
        function getshowtip(type,content){
        	
        	if("show"==type){
        		$("#tipBg").show();
        		$("#pp22").show();
        		$("#filmTips").hide();
        	}else if("message"==type){
        		$("#tipBg").show();
        		$("#pp22").hide();
        		$("#filmTips").show();
        		$("#errorinfo").html(content);
        		requestCount = 1;
        		window.clearInterval(interval);
        	}else{
        		$("#tipBg").hide();
        		$("#pp22").hide();
        		$("#filmTips").hide();
        		$("#submitBtn").attr("disabled", false);
				$("#submitBtn").val("提交");
        	}
        }
        
        
        function validatePaystatus(){
        	if(requestCount>10){
        		getshowtip("message","很抱歉,当前支付人数过多,本次支付请求失败,请重新支付");
        		return;
        	}
        	requestCount++;
        	$.ajax({
				url:"member-checkOrderStatus.html",
				type:"post",
				scriptCharset: 'utf-8',
				data:{
					pid:$("#pid").val(),
					oid:$("#sum_id").val()
					},
				dataType: 'html',
				success:function(r){
					if(r=="S"){//返回支付结果.支付成功
						$("#successbtn").show();
					$(".btnGray2").hide();
						getshowtip("message","支付成功，请至\"我的订单\"查看取票码");
// 						window.location="ticket-qryorder.html";
					}else if(r=='A'){
						$("#successbtn").show();
						$(".btnGray2").hide();
						getshowtip("message","已支付,勿重复支付,请至\"我的订单\"查看取票码");
						//	window.location="/error.jsp";
						//	alert("请票失败！");
					}else if(r!=""&&r!=" "&&r!="null"){
						$("#successbtn").hide();
						$(".btnGray2").show();
						getshowtip("message",r);
					}
				},
				error:function(){
					getshowtip("message","很抱歉，当前支付人数过多，本次支付请求失败，请重新支付");
				}
			});
        }
    </script>