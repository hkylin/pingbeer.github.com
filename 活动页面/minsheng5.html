<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name= "format-detection" content= "telephone=no" />
    <title>我的特权</title>
    <link rel="icon" href="/promotion/favicon.ico"/>
    <script language="javascript" type="text/javascript">
        contextPath="/promotion";
    </script>
    <script src="/promotion/js/activityday/jquery-2.1.0.min.js?version=20170401" type="text/javascript"></script>
    <script src="/promotion/js/activityday/activitydayMain.js?version=20170401" type="text/javascript"></script>
    <!-- 引入fastclick,消除移動端的點擊延遲 非必須 可不用 -->
    <script src="/promotion/js/activityday/fastclick_enc.min.js?version=20170401" type="text/javascript"></script>
    <script src="/promotion/js/activityday/swipe.js?version=20170401" type="text/javascript"></script>

    <link href="/promotion/css/activityday/default.css?version=20170401" rel="stylesheet" type="text/css">
    <link href="/promotion/css/activityday/ms_lxl.css?version=20170401" rel="stylesheet" type="text/css">
    <link href="/promotion/css/activityday/zl_ms.css?version=20170401" rel="stylesheet" type="text/css">
    <script type="text/javascript">var ctx = '/promotion';</script>
</head>
<body>

<script src="/promotion/js/activityday/register.min.js?version=20170401" type="text/javascript"></script>
<script type="text/javascript">
    $(function(){
        $("#imgAsynchHttpReqArea").click(function() {
            var timestamp = (new Date()).getTime();
            $(this).attr("src", ctx + "/activitydaycaptcha.jhtml?timestamp=" + timestamp);
        });
        //引入fastclick,消除移動端的點擊延遲 優化體驗 非必須 可不用
        FastClick.attach(document.body);

        $(".cvtrule_title").on('click',function(){
            $(this).toggleClass('on');
            $(this).siblings(".cvt_rule").toggleClass('none');
        });

        $(".ylw_btn").on('click',function(){
            $("#dh_fial1").addClass('none');
            $("#dh_fial2").addClass('none');
            $("#dh_fial3").addClass('none');
            $("#dh_fial4").addClass('none');
            $("#dh_fial5").addClass('none');
            $("#dh_ing").addClass('none');
            $("#dh_success").addClass('none');
            $("#dh_fial6").addClass('none');
        });

        $(".ico_close").on('click',function(){
            $("#dh_fial1").addClass('none');
            $("#dh_fial2").addClass('none');
            $("#dh_fial3").addClass('none');
            $("#dh_fial4").addClass('none');
            $("#dh_fial5").addClass('none');
            $("#dh_ing").addClass('none');
            $("#dh_success").addClass('none');
            $("#dh_fial6").addClass('none');
        });
        $("#sure_btn").on('click',function(){
            var captchaValueIndex =$("#HidIndex").val();

            var imageKey =$("#imageKey").val();


            jQuery.ajax({
                type:"POST",
                data:{'prodId':'5','j_captcha':captchaValueIndex,'imageKey':imageKey},
                url:contextPath + "/activityday/goOrder.jhtml?temp="+(new Date()).getTime(),
                success: function(data){
                    // toFlushYzm();
                    queryOrderResult();
                    if(data.result=='1'){//图片验证不通过
                        alert("图片验证不通过");
                        i=0;
                    }else if(data.result=='2'){//库存已经抢光
                        alert("库存已经抢光");
                        i=0;
                    }else if(data.result=='3'){//你今天已经下过单
                        alert("你今天已经下过单");
                        i=0;
                    }else if(data.result=='5'){//卡列表不满足条件
                        alert("卡列表不满足条件");
                        i=0;
                    }else if(data.result=='4'){//成功放入下单队列
                        interval=self.setInterval("queryOrderResult()",200);  //1秒
                    }else{
                        alert("最后一个错误");
                    }
                },
                error:function(XMLHttpRequest,textStatus,errorThrown){
                    alert("error");
                    $("#sure_btn").click();
                }
            });
        });

    });
    var interval;
    var count=0;
    var i=0;
    function queryOrderResult(){

        jQuery.ajax({
            type  :'POST',
            url   :contextPath+'/activityday/searchAddOrderResult.jhtml?timestamp='+new Date().getTime()+"&count=0",
            async :false,
            success :function(data){
                if(data.result=='0'){//兑换失败
                    alert("兑换失败");
                    i=0;
                    interval=window.clearInterval(interval);
                }else if(data.result=='2'){
                    alert("返回状态2");
                    interval=window.clearInterval(interval);
                }else{//兑换成功
                    $("#dh_ing").addClass('none');
                    $("#dh_success").removeClass('none');
                    interval=window.clearInterval(interval);
                }
            }
        });

    }
</script>
<!-- 01-16天天周五六点评券兑换页面.fw -->
<div id="ms_01_16" class="flex">
    <div class="top_bar">
        <div class="top_home"><img src="/promotion/images/activityday/ico_home.png" onclick="goHome()"></div>
        <div class="top_logo"><img src="/promotion/images/activityday/ico_logo.png"></div>
        <div class="top_person"><img src="/promotion/images/activityday/ico_person.png" onclick="goMyList()"></div>
    </div>	<div style="position: absolute; top: 0px; left: 0px; text-align: center; z-index: 100; background: rgb(0, 0, 0) none repeat scroll 0% 0%; width: 100%; height: 100%;opacity:0.3; display:none;" id="masklel">
</div>
    <input name="imageKey" id="imageKey" type="hidden"></input>
    <div id="con" style="position:absolute;left:30%;top:15%;z-index:101;width:321px; overflow:hidden; background:#fff;margin:0 auto; margin-top:80px; display:none;">
        <div class="evaItem clearfix">
            <div class="itemDetail fl zh_authcode_component zh_authcode_grid">
                <div class="zh_authcode_grid_head clearfix">
                    <div class="zh_authcode_grid_input">
                        <div class="inputc"></div>
                        <div class="inputc"></div>
                        <div class="inputc"></div>
                        <div class="inputc"></div>
                        <div class="zh_authcode_backspace J_captcha_backspace"></div>
                        <input name="HidIndex" id="HidIndex" type="hidden"></input>
                    </div>
                </div>
                <div class="zh_authcode_grid_content">
                    <img id="imgValadate" class="J_zh_authcode_img J_authcode_changes" src="#" alt="验证码">
                    <a class="vCodeUpdate J_authcode_change" href="javascript:;">换一个</a>

                    <div class="zh_authcode_help">点击框内文字输入上图中<span class="c_c00">汉字</span>对应汉字</div>
                    <div id="DivCon" class="zh_authcode_buttons clearfix J_authcode_buttons">
                    </div>
                </div>
            </div>
            <div class="zh_authcode_grid_content">
                <input id="BtnComfir" type="button" value="确定"/>
            </div>

            <div class="regTips J_authcodeTips">
                <i class="tipsEmpt"></i>
                <i class="tipsTxt"></i>
                <span class="tipsCont">请输入验证码</span>
            </div>
        </div>
    </div>

    <div class="content">
        <div class="convert_top">
            <div class="cvt_item border b_lrb">
                <span class="ico_top"></span>
                <span class="ico_ylt"></span>
                <span class="ico_yrt"></span>
                <p class="cvt_img"><img src="/promotion/images/activityday/eveday_05.jpg"></p>
            </div>
        </div>

        <div class="w_cvt border b_top_btm">
            <div class="w_box border b_btm">
                <p class="w_title">大众点评满50减30美食券</p>
                <div class="wkit">
                    <div class="wkit_1">有效期：长期有效</div>
                    <div class="wkit_3" id="timer"></div>
                </div>
            </div>
            <p class="w_tiaoma"><span class="jf_num">0</span> <em>元</em></p>

            <div class="gift_redeem border b_top">
                <div>数量</div>
                <div>
                    <p class="num_change">
                        <span class="minusBtn"></span>
                        <span class="num_int">1</span>
                        <span class="plusBtn"></span>
                    </p>
                </div>
            </div>

            <div class="gift_redeem border b_top">
                <div>小计</div>
                <div><span class="col_ylow"><em>0</em>元</span></div>
            </div>

            <div class="gift_redeem code_dov border b_top">
                <div>
                    <p class="yzm_box">
                        <span class="yzm_sp1">验证码</span>
                        <span class="yzm_sp2"><input style="background:#fff;border:0;color:red;text-align:center;" type="button" name="j_captcha" id="j_captcha" maxlength="4" value="点击获取验证码"/></span>
                        <!--
                        <span class="yzm_sp2"><input type="text" name="j_captcha" id="j_captcha" maxlength="4" placeholder="请输入右图验证码"/></span>
                        -->
                    </p>
                </div>
                <!-- 
                <div><p><img id="imgAsynchHttpReqArea" height="35px" src="/promotion/activitydaycaptcha.jhtml?timestamp=1490925106136"/></p></div>
                -->
            </div>
        </div>

        <div class="w_cvt border b_top_btm">
            <div class="cvtrule">
                <!--TODO:状态控制添加class=on-->
                <p class="cvtrule_title">使用细则 <i class="ico_wtb"></i></p>
                <!--TODO: none 隐藏-->
                <div class="cvt_rule">
                    <p>1.刷民生信用卡当月计积分消费满3笔99元，即可于达标当月的每周五在民生信用卡微信“我的特权”领取美食券兑换码一个，每人每活动日限领取一个，名额有限，先到先得，每活动日两次抢兑时间：上午10点和下午15点；</p>
                    <p>2.达标客户领取兑换码后，请凭此兑换码在民生信用卡与大众点评专属页面上领取美食券；</p>
                    <p>3.美食券自在大众点评领取之日起3个月内有效，一旦使用将无法退回；</p>
                    <p>4.进入大众点评APP购买美食团购及闪惠（手机买单/闪惠买单）时使用，部分特殊类团购不可使用；</p>
                    <p>5.美食券不可提现，每张券仅能使用一次，需要订单满50元方可使用，订单抵扣后差额部分需要单独支付；</p>
                    <p>6.每次消费仅能使用一张优惠券；</p>
                    <p>7.如有疑问，请致电大众点评客服电话10100011(工作时间：周一至周日8:00-21:00)。</p>
                </div>
            </div>

        </div>

    </div><!-- content end -->

    <div class="foter">
        <p class="btn_card" id="sure_btn">确认兑换</p>
    </div>

    <!--弹出 已经对光了 none 隐藏-->
    <div class="pop_wraper none" id="dh_fial1">
        <div class="pop_outer">
            <div class="pop_cont">
                <span class="ico_close"></span>
                <p class="pop_icon"><span class="ico_fial"></span></p>
                <p class="pop_title">请填写验证码</p>
                <p class="pbtn_p"><span class="ylw_btn">返 回</span></p>
            </div>
        </div>
    </div>
    <!--弹出 已经对光了 none 隐藏-->
    <div class="pop_wraper none" id="dh_fial2">
        <div class="pop_outer">
            <div class="pop_cont">
                <span class="ico_close"></span>
                <p class="pop_icon"><span class="ico_fial"></span></p>
                <p class="pop_title">图片验证码验证不通过</p>
                <p class="pbtn_p"><span class="ylw_btn">返 回</span></p>
            </div>
        </div>
    </div>

    <!--弹出 已经对光了 none 隐藏-->
    <div class="pop_wraper none" id="dh_fial3">
        <div class="pop_outer">
            <div class="pop_cont">
                <span class="ico_close"></span>
                <p class="pop_icon"><span class="ico_fial"></span></p>
                <p class="pop_title">活动火爆抢购中，请您再次尝试</p>
                <p class="pbtn_p"><span class="ylw_btn">返 回</span></p>
            </div>
        </div>
    </div>

    <!--弹出 已经对光了 none 隐藏-->
    <div class="pop_wraper none" id="dh_fial4">
        <div class="pop_outer">
            <div class="pop_cont">
                <span class="ico_close"></span>
                <p class="pop_icon"><span class="ico_fial"></span></p>
                <p class="pop_title">10点和15点开抢，已经抢光啦！</p>
                <p class="pbtn_p"><span class="ylw_btn">返 回</span></p>
            </div>
        </div>
    </div>

    <div class="pop_wraper none" id="dh_fail5">
        <div class="pop_outer">
            <div class="pop_cont">
                <span class="ico_close"></span>
                <p class="pop_icon"></p>
                <p class="pop_title">兑换超时</p>
                <p class="pbtn_p" onclick="goMyList()"><span class="ylw_btn">查看我的特权</span></p>
            </div>
        </div>
    </div>

    <div class="pop_wraper none" id="dh_ing">
        <div class="pop_outer">
            <div class="pop_cont">
                <span class="ico_close"></span>
                <p class="pop_title">抢兑中，请稍候……</p>
            </div>
        </div>
    </div>

    <!--弹出 兑换成功 none 隐藏-->
    <div class="pop_wraper none" id="dh_success">
        <div class="pop_outer">
            <div class="pop_cont">
                <span class="ico_close"></span>
                <p class="pop_icon"><span class="ico_success"></span></p>
                <p class="pop_title">兑换成功</p>
                <div class="pop_page">
                    恭喜您已成功兑换大众点评满50减30美食券1张！愿您天天好心情！
                </div>
                <p class="pbtn_p" onclick="goMyList()"><span class="ylw_btn">查看我的特权</span></p>
            </div>
        </div>
    </div>

    <div class="pop_wraper none" id="dh_fial6">
        <div class="pop_outer">
            <div class="pop_cont">
                <span class="ico_close"></span>
                <p class="pop_icon"><span class="ico_fial"></span></p>
                <p class="pop_title">兑换失败，请您再次尝试</p>
                <p class="pbtn_p" onclick="goHome()"><span class="ylw_btn">返回首页</span></p>
            </div>
        </div>
    </div>

</div>
<input type="hidden" value="494" id="nowDate" name="nowDate"/>

<script type="text/javascript">
    //倒计时
    var addTimer = function () {
        var list = [],
            interval;

        return function (id, time) {
            if (!interval)
                interval = setInterval(go, 1000);
            list.push({ ele: document.getElementById(id), time: time });
        }

        function go() {
            for (var i = 0; i < list.length; i++) {
                list[i].ele.innerHTML = getTimerString(list[i].time ? list[i].time -= 1 : 0);
                if (!list[i].time)
                    list.splice(i--, 1);
            }
        }

        function getTimerString(time) {
            var not0 = !!time,
                h = Math.floor(time / 3600),
                m = Math.floor((time %= 3600) / 60),
                s = time % 60;
            if(h<10){ hh='0'+h; }else{ hh=h; }
            if(m<10){ mm='0'+m; }else{ mm=m; }
            if(s<10){ ss='0'+s; }else{ ss=s; }
            if (not0 &&time >=0)
                return "距离抢兑开始还有" + hh + ":" + mm + ":" + ss ;
            else
                return "";
        }
    } ();
    var timer = $("#nowDate").val();
    if(timer != 0){
        addTimer("timer",timer);
    }
</script>
<script>
    var _hmt = _hmt || [];
    (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?3d3a094b33b15c394ba6e7d495ad808a";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

</body>
</html>
